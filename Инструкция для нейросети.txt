# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è –ò–ò: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–æ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ email

## üéØ –û–ë–©–ê–Ø –ó–ê–î–ê–ß–ê

–°–æ–∑–¥–∞—Ç—å Python-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ:
1. –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Zoho Mail —á–µ—Ä–µ–∑ IMAP
2. –ù–∞—Ö–æ–¥–∏—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–∏—Å—å–º–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –Ω–µ–¥–µ–ª–∏
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –ø–∏—Å—å–º–∞ –∏—â–µ—Ç –æ—Ç–≤–µ—Ç –æ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—è
4. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —á–µ—Ä–µ–∑ LM Studio API
5. –û–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ Excel —Ñ–∞–π–ª–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞

## üìã –î–ï–¢–ê–õ–¨–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø

### 1. –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê

–°–æ–∑–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–æ–≤:
```
email_bot/
‚îú‚îÄ‚îÄ main.py                 # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ settings.py         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ config.yaml         # –§–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ imap_client.py      # –†–∞–±–æ—Ç–∞ —Å IMAP
‚îÇ   ‚îú‚îÄ‚îÄ excel_processor.py  # –†–∞–±–æ—Ç–∞ —Å Excel
‚îÇ   ‚îú‚îÄ‚îÄ lm_studio_client.py # –†–∞–±–æ—Ç–∞ —Å LM Studio API
‚îÇ   ‚îî‚îÄ‚îÄ utils.py           # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ logs/                   # –ü–∞–ø–∫–∞ –¥–ª—è –ª–æ–≥–æ–≤ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ requirements.txt        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ .env.example           # –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ README.md              # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

### 2. –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø (config/settings.py –∏ config.yaml)

#### config.yaml –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
```yaml
imap:
  host: "imappro.zoho.eu"
  port: 993
  timeout: 30
  retry_attempts: 3
  folders:
    sent: ["Sent Items", "Sent"]
    inbox: ["INBOX"]

search:
  days_back: 14
  max_emails_per_batch: 100
  
lm_studio:
  timeout: 90
  max_tokens: 512
  temperature: 0.0
  retry_attempts: 2
  
excel:
  target_columns: 
    - "Price usd"
    - "Price usd casino" 
    - "Payment"
    - "Language"
    - "Comments"
  mail_column: "Mail"
  backup: true
  highlight_changes: true

logging:
  level: "INFO"
  file: "bot.log"
  format: "[%(asctime)s] [%(levelname)s] %(message)s"
  date_format: "%Y-%m-%d %H:%M:%S"
```

#### settings.py –¥–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∂–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
```python
import yaml
import os
from pathlib import Path

class Settings:
    def __init__(self):
        config_path = Path(__file__).parent / "config.yaml"
        with open(config_path, 'r', encoding='utf-8') as f:
            self.config = yaml.safe_load(f)
    
    def get(self, key_path, default=None):
        """–ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –ø—É—Ç–∏ —Ç–∏–ø–∞ 'imap.host'"""
        keys = key_path.split('.')
        value = self.config
        for key in keys:
            value = value.get(key, {})
        return value if value != {} else default

settings = Settings()
```

### 3. –°–ò–°–¢–ï–ú–ê –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø

–°–æ–∑–¥–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ utils.py:

```python
import logging
import os
from datetime import datetime
from pathlib import Path

def setup_logging(log_level="INFO", log_file="bot.log"):
    """
    –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å –∑–∞–ø–∏—Å—å—é –≤ —Ñ–∞–π–ª –∏ –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å
    """
    # –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ logs –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    log_dir = Path("logs")
    log_dir.mkdir(exist_ok=True)
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–≥–µ—Ä–∞
    logger = logging.getLogger('EmailBot')
    logger.setLevel(getattr(logging, log_level.upper()))
    logger.handlers.clear()  # –û—á–∏—Å—Ç–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö handlers
    
    # –§–æ—Ä–º–∞—Ç—Ç–µ—Ä
    formatter = logging.Formatter(
        '[%(asctime)s] [%(levelname)s] [%(name)s] %(message)s',
        datefmt='%Y-%m-%d %H:%M:%S'
    )
    
    # –§–∞–π–ª–æ–≤—ã–π handler
    file_handler = logging.FileHandler(
        log_dir / log_file, 
        encoding='utf-8'
    )
    file_handler.setLevel(logging.DEBUG)
    file_handler.setFormatter(formatter)
    logger.addHandler(file_handler)
    
    # –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π handler
    console_handler = logging.StreamHandler()
    console_handler.setLevel(logging.INFO)
    console_handler.setFormatter(formatter)
    logger.addHandler(console_handler)
    
    return logger
```

### 4. IMAP –ö–õ–ò–ï–ù–¢ (src/imap_client.py)

–°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å IMAP —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏:

#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–ª–∞—Å—Å—É IMAPClient:

1. **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
2. **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏** –ø—Ä–∏ —Å–±–æ—è—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
3. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–æ–∫** –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö –ø–∏—Å–µ–º
4. **–ü–æ–∏—Å–∫ –ø–∏—Å–µ–º –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º**

```python
class IMAPClient:
    def __init__(self, host, port, email, password, logger):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞"""
        pass
    
    def __enter__(self):
        """–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä - –≤—Ö–æ–¥"""
        pass
    
    def __exit__(self, exc_type, exc_val, exc_tb):
        """–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä - –≤—ã—Ö–æ–¥"""
        pass
    
    def connect(self):
        """–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ IMAP —Å–µ—Ä–≤–µ—Ä—É —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏"""
        pass
    
    def get_sent_emails(self, days_back=14):
        """
        –ü–æ–ª—É—á–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–∏—Å—å–º–∞ –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: List[Dict] —Å –ø–æ–ª—è–º–∏:
        - to: email –ø–æ–ª—É—á–∞—Ç–µ–ª—è
        - message_id: ID —Å–æ–æ–±—â–µ–Ω–∏—è  
        - subject: —Ç–µ–º–∞ –ø–∏—Å—å–º–∞
        - normalized_subject: –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ç–µ–º–∞
        - date: –¥–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
        - body: —Ç–µ–ª–æ –ø–∏—Å—å–º–∞
        - references: —Ü–µ–ø–æ—á–∫–∞ References
        """
        pass
    
    def find_reply(self, sent_email_data):
        """
        –ù–∞–π—Ç–∏ –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ –ø–∏—Å—å–º–æ
        –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ–∏—Å–∫–∞ (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É):
        1. –ü–æ In-Reply-To –∑–∞–≥–æ–ª–æ–≤–∫—É
        2. –ü–æ References —Ü–µ–ø–æ—á–∫–µ
        3. –ü–æ FROM + SUBJECT + –¥–∞—Ç–µ
        4. –ü–æ FROM + —á–∞—Å—Ç–∏—á–Ω–æ–º—É SUBJECT
        5. –ü–æ FROM + –¥–∞—Ç–µ (–ø–æ—Å–ª–µ–¥–Ω–µ–µ –ø–∏—Å—å–º–æ)
        
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: Dict —Å –ø–æ–ª—è–º–∏ from, subject, body, date –∏–ª–∏ None
        """
        pass
```

#### –û—Å–æ–±—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–æ–∏—Å–∫—É:

1. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã –ø–∏—Å—å–º–∞**: —É–¥–∞–ª—è—Ç—å "RE:", "FWD:", –Ω–æ–º–µ—Ä–∞ –≤ —Å–∫–æ–±–∫–∞—Ö
2. **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–æ–∏—Å–∫**: —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –≤ IMAP –∑–∞–ø—Ä–æ—Å–∞—Ö
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–æ–∫**: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ Subject, From
4. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞**: –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç text/plain, fallback –Ω–∞ text/html —Å —É–¥–∞–ª–µ–Ω–∏–µ–º HTML —Ç–µ–≥–æ–≤

### 5. LM STUDIO –ö–õ–ò–ï–ù–¢ (src/lm_studio_client.py)

–°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å LM Studio API:

```python
class LMStudioClient:
    def __init__(self, api_url, model_name, logger, timeout=90):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞"""
        pass
    
    def analyze_email(self, email_body, target_fields, retries=2):
        """
        –ê–Ω–∞–ª–∏–∑ –ø–∏—Å—å–º–∞ —á–µ—Ä–µ–∑ LM Studio
        
        –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
        - email_body: —Ç–µ–∫—Å—Ç –ø–∏—Å—å–º–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
        - target_fields: —Å–ø–∏—Å–æ–∫ –ø–æ–ª–µ–π –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
        - retries: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
        
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: Dict —Å –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–ª–∏ None –ø—Ä–∏ –æ—à–∏–±–∫–µ
        """
        pass
    
    def _create_prompt(self, email_body, target_fields):
        """
        –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è LM Studio
        
        –í–ê–ñ–ù–û: –ü—Ä–æ–º–ø—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, —á–µ—Ç–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω
        –¢—Ä–µ–±–æ–≤–∞—Ç—å JSON –æ—Ç–≤–µ—Ç –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–±—ä—è—Å–Ω–µ–Ω–∏–π
        """
        prompt = f"""
        –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ç–µ–∫—Å—Ç –ø–∏—Å—å–º–∞ –∏ –∏–∑–≤–ª–µ–∫–∏ —Å–ª–µ–¥—É—é—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.
        –ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –æ—Å—Ç–∞–≤—å –ø–æ–ª–µ –ø—É—Å—Ç—ã–º ("").
        
        –ü–æ–ª—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è:
        {chr(10).join(f'- {field}' for field in target_fields)}
        
        –í–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ JSON –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.
        
        –¢–µ–∫—Å—Ç –ø–∏—Å—å–º–∞:
        {email_body}
        """
        return prompt
    
    def _parse_response(self, response_text, target_fields):
        """
        –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ –æ—Ç LM Studio
        
        –í–ê–ñ–ù–û: 
        1. –ù–∞–π—Ç–∏ JSON –≤ —Ç–µ–∫—Å—Ç–µ (–º–æ–∂–µ—Ç –±—ã—Ç—å –æ–∫—Ä—É–∂–µ–Ω –¥—Ä—É–≥–∏–º —Ç–µ–∫—Å—Ç–æ–º)
        2. –£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ // –∏–∑ JSON
        3. –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
        4. –í–µ—Ä–Ω—É—Ç—å —Å–ª–æ–≤–∞—Ä—å —Å –Ω—É–∂–Ω—ã–º–∏ –ø–æ–ª—è–º–∏
        """
        pass
```

### 6. EXCEL –ü–†–û–¶–ï–°–°–û–† (src/excel_processor.py)

–°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Excel —Ñ–∞–π–ª–∞–º–∏:

```python
class ExcelProcessor:
    def __init__(self, file_path, logger, mail_column="Mail", target_columns=None):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞"""
        pass
    
    def load_data(self):
        """
        –ó–∞–≥—Ä—É–∑–∫–∞ Excel —Ñ–∞–π–ª–∞
        –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
        """
        pass
    
    def create_email_index(self):
        """
        –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ email -> [—Å–ø–∏—Å–æ–∫ –∏–Ω–¥–µ–∫—Å–æ–≤ —Å—Ç—Ä–æ–∫]
        –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è email –∞–¥—Ä–µ—Å–æ–≤ (–ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É, trim)
        """
        pass
    
    def update_rows(self, email, extracted_data):
        """
        –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ –≤ DataFrame –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ email
        –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏
        """
        pass
    
    def save_with_backup(self):
        """
        –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
        –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —è—á–µ–µ–∫ –∂–µ–ª—Ç—ã–º —Ü–≤–µ—Ç–æ–º
        """
        pass
    
    def highlight_changes(self):
        """
        –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —è—á–µ–µ–∫ –≤ Excel —Ñ–∞–π–ª–µ
        –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å openpyxl –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        """
        pass
```

### 7. –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê (main.py)

–°–æ–∑–¥–∞—Ç—å –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª —Å —á–µ—Ç–∫–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –¥–µ–π—Å—Ç–≤–∏–π:

```python
def main():
    """
    –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏:
    
    1. –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
    3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ (IMAP, LM Studio, Excel)
    4. –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–∏—Å–µ–º
    5. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∏—Å—å–º–∞:
       - –ü–æ–∏—Å–∫ –æ—Ç–≤–µ—Ç–∞
       - –ê–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ LM Studio
       - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Excel
    6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    7. –í—ã–≤–æ–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    """
    pass

class ProcessingStats:
    """
    –ö–ª–∞—Å—Å –¥–ª—è —Å–±–æ—Ä–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
    """
    def __init__(self):
        self.start_time = time.time()
        self.total_sent = 0
        self.replies_found = 0
        self.lm_analysis_success = 0
        self.excel_updates = 0
        self.errors = {'imap': 0, 'lm_studio': 0, 'excel': 0}
    
    def log_summary(self, logger):
        """–í—ã–≤–æ–¥ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏"""
        pass
```

### 8. –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö –ò –ü–û–í–¢–û–†–ù–´–ï –ü–û–ü–´–¢–ö–ò

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫:

```python
import time
import random
from functools import wraps

def retry_with_backoff(max_retries=3, base_delay=1, backoff_factor=2):
    """
    –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
    """
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            for attempt in range(max_retries):
                try:
                    return func(*args, **kwargs)
                except Exception as e:
                    if attempt == max_retries - 1:
                        raise e
                    
                    delay = base_delay * (backoff_factor ** attempt) + random.uniform(0, 1)
                    time.sleep(delay)
                    
                    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏
                    if hasattr(args[0], 'logger'):
                        args[0].logger.warning(f"Retry {attempt + 1}/{max_retries} for {func.__name__} after {delay:.2f}s: {e}")
            
            return None
        return wrapper
    return decorator
```

### 9. –í–ê–õ–ò–î–ê–¶–ò–Ø –î–ê–ù–ù–´–•

–°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ utils.py:

```python
import re
from email.utils import parseaddr

def validate_email(email):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ email –∞–¥—Ä–µ—Å–∞"""
    pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
    return re.match(pattern, email.strip()) is not None

def validate_excel_structure(df, required_columns):
    """
    –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã Excel —Ñ–∞–π–ª–∞
    - –ù–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
    - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å email –∞–¥—Ä–µ—Å–æ–≤
    - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ email
    """
    missing_columns = [col for col in required_columns if col not in df.columns]
    if missing_columns:
        raise ValueError(f"Missing columns: {missing_columns}")
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏...
    return True

def normalize_email(email):
    """–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è email –∞–¥—Ä–µ—Å–∞"""
    return email.strip().lower()

def normalize_subject(subject):
    """
    –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã –ø–∏—Å—å–º–∞
    - –£–¥–∞–ª–µ–Ω–∏–µ RE:, FWD:, –Ω–æ–º–µ—Ä–æ–≤ –≤ —Å–∫–æ–±–∫–∞—Ö
    - –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
    - –£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤
    """
    if not subject:
        return ""
    
    # –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤
    pattern = r'^(RE(\[\d+\])?:|FWD?:|\[EXTERNAL\])\s*'
    
    while True:
        new_subject = re.sub(pattern, '', subject, flags=re.IGNORECASE).strip()
        if new_subject == subject:
            break
        subject = new_subject
    
    return subject.lower()
```

### 10. –ü–ï–†–ï–ú–ï–ù–ù–´–ï –û–ö–†–£–ñ–ï–ù–ò–Ø (.env —Ñ–∞–π–ª)

–°–æ–∑–¥–∞—Ç—å .env.example —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:

```bash
# Zoho Mail –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
ZOHO_EMAIL=your_email@zoho.com
ZOHO_APP_PASSWORD=your_app_specific_password

# LM Studio –Ω–∞—Å—Ç—Ä–æ–π–∫–∏  
LMSTUDIO_API_URL=http://localhost:1234/v1/completions
LM_MODEL_NAME=your_model_name

# Excel —Ñ–∞–π–ª (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –ø—É—Ç—å)
EXCEL_FILE_PATH=Mail_USD.xlsx

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
LOG_LEVEL=INFO
```

### 11. –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö DEPENDENCIES (requirements.txt)

```
pandas>=1.5.0
openpyxl>=3.0.0
requests>=2.28.0
python-dotenv>=0.19.0
PyYAML>=6.0
beautifulsoup4>=4.11.0
email-validator>=1.3.0
```

### 12. –°–ü–ï–¶–ò–ê–õ–¨–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –û–ë–†–ê–ë–û–¢–ö–ï

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ IMAP –ø–æ–∏—Å–∫–∞:
1. **–≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å –ø—Ä–æ–±–µ–ª–∞–º–∏, @ —Å–∏–º–≤–æ–ª–∞–º–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –∫–∞–≤—ã—á–∫–∞—Ö
2. **–ö–æ–¥–∏—Ä–æ–≤–∫–∞**: –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ Subject –∏ From
3. **Fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏**: –ï—Å–ª–∏ —Ç–æ—á–Ω—ã–π –ø–æ–∏—Å–∫ –Ω–µ –¥–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ —à–∏—Ä–æ–∫–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ LM Studio –æ—Ç–≤–µ—Ç–æ–≤:
1. **–û—á–∏—Å—Ç–∫–∞**: –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ `//` –∏–∑ JSON
2. **–ü–æ–∏—Å–∫ JSON**: –ú–æ–∂–µ—Ç –±—ã—Ç—å –æ–∫—Ä—É–∂–µ–Ω –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
3. **Fallback**: –ï—Å–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ JSON –Ω–µ —É–¥–∞–ª—Å—è, –ø–æ–º–µ—Å—Ç–∏—Ç—å –≤–µ—Å—å —Ç–µ–∫—Å—Ç –≤ –ø–æ–ª–µ "Comments"

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ Excel:
1. **–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏**: –í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å backup —Å timestamp
2. **–ü–æ–¥—Å–≤–µ—Ç–∫–∞**: –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —è—á–µ–π–∫–∏ –≤—ã–¥–µ–ª—è—Ç—å –∂–µ–ª—Ç—ã–º —Ü–≤–µ—Ç–æ–º
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã

### 13. –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –°–û–ë–´–¢–ò–ô

–í—Å–µ –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–æ–ª–∂–Ω—ã –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è:

- **INFO**: –ù–∞—á–∞–ª–æ/–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞, –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø–∏—Å—å–º–∞, —É—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- **WARNING**: –ù–µ–Ω–∞–π–¥–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã, –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–∏—Å–∫–∞
- **ERROR**: –û—à–∏–±–∫–∏ API, –ø—Ä–æ–±–ª–µ–º—ã —Å —Ñ–∞–π–ª–∞–º–∏
- **DEBUG**: –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–∏—Å–∫–µ, –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ API

### 14. –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –ü–†–ò–ù–¶–ò–ü–´

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**: –ö–∞–∂–¥—ã–π –∫–ª–∞—Å—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é –æ–±–ª–∞—Å—Ç—å
2. **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã**: –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –ù–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
4. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ—Å—Ç—å**: –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —Ñ–∞–π–ª–∞—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
5. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ö–æ–¥ –¥–æ–ª–∂–µ–Ω –ª–µ–≥–∫–æ –ø–æ–∫—Ä—ã–≤–∞—Ç—å—Å—è —Ç–µ—Å—Ç–∞–º–∏

### 15. –§–ò–ù–ê–õ–¨–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø

–ü—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ –∫–æ–¥–∞ —É—á–∏—Ç—ã–≤–∞—Ç—å:

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ù–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤—Å–µ –ø–∏—Å—å–º–∞ –≤ –ø–∞–º—è—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ù–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª–∏ –∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
3. **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**: –ü–æ–¥—Ä–æ–±–Ω—ã–µ docstrings –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –∫–ª–∞—Å—Å–æ–≤
4. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –ö–æ–¥ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ Python 3.8+
5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –¥–æ–ª–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ:
- –°—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏ email
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∏ –∫–æ–¥–∏—Ä–æ–≤–∫–∏
- –ò–º–µ–µ—Ç –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –õ–µ–≥–∫–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –±–µ–∑ –ø–∞–¥–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ä–∞–±–æ—Ç—ã